From: Markus Koschany <apo@debian.org>
Date: Wed, 17 Aug 2022 17:31:44 +0200
Subject: CVE-2022-27781

Origin: https://github.com/curl/curl/commit/5c7da89d404bf59
---
 lib/vtls/nss.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/lib/vtls/nss.c b/lib/vtls/nss.c
index e14316e..4fa25e6 100644
--- a/lib/vtls/nss.c
+++ b/lib/vtls/nss.c
@@ -723,6 +723,9 @@ static void display_cert_info(struct SessionHandle *data,
   PR_Free(common_name);
 }
 
+/* A number of certs that will never occur in a real server handshake */
+#define TOO_MANY_CERTS 300
+
 static void display_conn_info(struct connectdata *conn, PRFileDesc *sock)
 {
   SSLChannelInfo channel;
@@ -759,6 +762,11 @@ static void display_conn_info(struct connectdata *conn, PRFileDesc *sock)
         cert2 = CERT_FindCertIssuer(cert, now, certUsageSSLCA);
         while(cert2) {
           i++;
+          if(i >= TOO_MANY_CERTS) {
+            CERT_DestroyCertificate(cert2);
+            failf(conn->data, "certificate loop");
+            return CURLE_SSL_CERTPROBLEM;
+          }
           if(cert2->isRoot) {
             CERT_DestroyCertificate(cert2);
             break;
