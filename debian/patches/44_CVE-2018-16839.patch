From: Markus Koschany <apo@debian.org>
Date: Mon, 5 Nov 2018 23:39:05 +0100
Subject: 44_CVE-2018-16839

Origin: https://github.com/curl/curl/commit/f3a24d7916b9173c69a3e0ee790102993833d6c5
---
 lib/curl_sasl.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/lib/curl_sasl.c b/lib/curl_sasl.c
index 7e2b8af..c0b91b3 100644
--- a/lib/curl_sasl.c
+++ b/lib/curl_sasl.c
@@ -66,6 +66,12 @@ extern void Curl_sasl_gssapi_cleanup(struct kerberos5data *krb5);
 #define DIGEST_QOP_VALUE_STRING_AUTH_INT  "auth-int"
 #define DIGEST_QOP_VALUE_STRING_AUTH_CONF "auth-conf"
 
+#if defined(SIZEOF_SIZE_T) && (SIZEOF_SIZE_T > 4)
+#define SIZE_T_MAX 18446744073709551615U
+#else
+#define SIZE_T_MAX 4294967295U
+#endif
+
 /* Retrieves the value for a corresponding key from the challenge string
  * returns TRUE if the key could be found, FALSE if it does not exists
  */
@@ -174,6 +180,10 @@ CURLcode Curl_sasl_create_plain_message(struct SessionHandle *data,
   ulen = strlen(userp);
   plen = strlen(passwdp);
 
+  /* Compute binary message length. Check for overflows. */
+  if((ulen > SIZE_T_MAX/4) || (plen > (SIZE_T_MAX/2 - 2)))
+    return CURLE_OUT_OF_MEMORY;
+
   plainauth = malloc(2 * ulen + plen + 2);
   if(!plainauth) {
     *outlen = 0;
