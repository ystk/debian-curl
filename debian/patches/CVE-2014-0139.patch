Description: Reject IP address wildcard matches
 There are server certificates used with IP address in the CN field, but
 we MUST not allow wildcard certs for hostnames given as IP addresses
 only. Therefore we must make Curl_cert_hostcheck() fail such attempts.
Origin: upstream, http://curl.haxx.se/libcurl-reject-cert-ip-wildcards.patch
Forwarded: not-needed
Author: Daniel Stenberg <daniel@haxx.se>
Last-Update: 2014-04-09

--- a/lib/ssluse.c
+++ b/lib/ssluse.c
@@ -53,6 +53,7 @@
 #include "select.h"
 #include "sslgen.h"
 #include "rawstr.h"
+#include "inet_pton.h"
 
 #define _MPRINTF_REPLACE /* use the internal *printf() functions */
 #include <curl/mprintf.h>
@@ -1049,6 +1050,20 @@
 
 static int hostmatch(const char *hostname, const char *pattern)
 {
+
+  struct in_addr ignored;
+#ifdef ENABLE_IPV6
+  struct sockaddr_in6 si6;
+#endif
+
+  /* detect IP address as hostname and fail the match if so */
+  if(Curl_inet_pton(AF_INET, hostname, &ignored) > 0)
+    return HOST_NOMATCH;
+#ifdef ENABLE_IPV6
+  else if(Curl_inet_pton(AF_INET6, hostname, &si6.sin6_addr) > 0)
+    return HOST_NOMATCH;
+#endif
+
   while(1) {
     char c = *pattern++;
 
