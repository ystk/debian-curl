--- curl-7.38.0.orig/lib/curl_ntlm_core.c
+++ curl-7.38.0/lib/curl_ntlm_core.c
@@ -412,6 +412,12 @@ static void write64_le(const __int64 val
   write32_le((int)(value >> 32), buffer + 4);
 }
 
+#if defined(SIZEOF_SIZE_T) && (SIZEOF_SIZE_T > 4)
+#define SIZE_T_MAX 18446744073709551615U
+#else
+#define SIZE_T_MAX 4294967295U
+#endif
+
 /*
  * Set up nt hashed passwords
  */
@@ -420,8 +426,11 @@ CURLcode Curl_ntlm_core_mk_nt_hash(struc
                                    unsigned char *ntbuffer /* 21 bytes */)
 {
   size_t len = strlen(password);
-  unsigned char *pw = malloc(len * 2);
+  unsigned char *pw;
   CURLcode result;
+  if(len > SIZE_T_MAX/2) /* avoid integer overflow */
+    return CURLE_OUT_OF_MEMORY;
+  pw = len ? malloc(len * 2) : strdup("");
   if(!pw)
     return CURLE_OUT_OF_MEMORY;
 
