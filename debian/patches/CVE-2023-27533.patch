From: Markus Koschany <apo@debian.org>
Date: Sat, 8 Apr 2023 16:02:29 +0200
Subject: CVE-2023-27533

Origin: https://github.com/curl/curl/commit/538b1e79a6e7b0bb829ab4cecc828d32105d0684
---
 lib/telnet.c | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/lib/telnet.c b/lib/telnet.c
index d440aa7..52b5a16 100644
--- a/lib/telnet.c
+++ b/lib/telnet.c
@@ -818,6 +818,17 @@ static void printsub(struct SessionHandle *data,
   }
 }
 
+static bool str_is_nonascii(const char *str)
+{
+  size_t len = strlen(str);
+  while(len--) {
+    if(*str & 0x80)
+      return TRUE;
+    str++;
+  }
+  return FALSE;
+}
+
 static CURLcode check_telnet_options(struct connectdata *conn)
 {
   struct curl_slist *head;
@@ -832,6 +843,8 @@ static CURLcode check_telnet_options(struct connectdata *conn)
   /* Add the user name as an environment variable if it
      was given on the command line */
   if(conn->bits.user_passwd) {
+    if(str_is_nonascii(conn->user))
+      return CURLE_BAD_FUNCTION_ARGUMENT;
     snprintf(option_arg, sizeof(option_arg), "USER,%s", conn->user);
     beg = curl_slist_append(tn->telnet_vars, option_arg);
     if(!beg) {
